{% extends 'base.html' %}{% load static %}{% block title %}{{ car.title }} | خودروشاپ{% endblock %}{% block extra_css %}<style>  .car-gallery {    position: relative;    border-radius: 20px;    overflow: hidden;    background: rgba(255, 255, 255, 0.05);  }  .main-image {    width: 100%;    height: 400px;    object-fit: cover;    cursor: zoom-in;  }  .thumbnail-list {    display: flex;    gap: 10px;    margin-top: 15px;    overflow-x: auto;    padding-bottom: 10px;  }  .thumbnail {    width: 80px;    height: 80px;    border-radius: 10px;    object-fit: cover;    cursor: pointer;    border: 2px solid transparent;    transition: all 0.3s;    opacity: 0.7;  }  .thumbnail:hover,  .thumbnail.active {    border-color: var(--gold);    opacity: 1;    transform: scale(1.05);  }  .car-title {    font-size: 1.8rem;    font-weight: 700;    margin-bottom: 0.5rem;    background: linear-gradient(135deg, #fff, var(--gold));    -webkit-background-clip: text;    -webkit-text-fill-color: transparent;  }  .car-price {    font-size: 2rem;    font-weight: 900;    color: var(--gold);    text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);  }  .car-price-original {    font-size: 1.2rem;    color: rgba(255, 255, 255, 0.5);    text-decoration: line-through;    margin-right: 10px;  }  .specs-grid {    display: grid;    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));    gap: 15px;  }  .spec-item {    background: rgba(255, 255, 255, 0.05);    padding: 15px;    border-radius: 15px;    text-align: center;    border: 1px solid rgba(255, 255, 255, 0.1);    transition: all 0.3s;  }  .spec-item:hover {    background: rgba(255, 255, 255, 0.1);    transform: translateY(-5px);    border-color: var(--gold);  }  .spec-icon {    font-size: 1.5rem;    color: var(--gold);    margin-bottom: 8px;  }  .spec-label {    font-size: 0.85rem;    color: rgba(255, 255, 255, 0.7);    margin-bottom: 5px;  }  .spec-value {    font-size: 1rem;    font-weight: 700;    color: #fff;  }  .feature-badge {    display: inline-flex;    align-items: center;    gap: 8px;    padding: 8px 15px;    background: rgba(99, 102, 241, 0.2);    border: 1px solid rgba(99, 102, 241, 0.3);    border-radius: 50px;    margin: 5px;    font-size: 0.9rem;  }  .feature-badge i {    color: var(--gold);  }  .btn-action {    width: 100%;    padding: 15px;    border-radius: 15px;    font-weight: 600;    font-size: 1.1rem;    margin-bottom: 10px;    transition: all 0.3s;  }  .btn-favorite {    background: rgba(239, 68, 68, 0.2);    border: 1px solid rgba(239, 68, 68, 0.3);    color: #fff;  }  .btn-favorite:hover {    background: rgba(239, 68, 68, 0.4);  }  .btn-favorite.active {    background: #ef4444;  }  .dealer-card {    background: rgba(255, 255, 255, 0.05);    border-radius: 20px;    padding: 20px;    border: 1px solid rgba(255, 255, 255, 0.1);  }  .dealer-avatar {    width: 80px;    height: 80px;    border-radius: 50%;    object-fit: cover;    border: 3px solid var(--gold);  }  .similar-car-card {    background: rgba(255, 255, 255, 0.05);    border-radius: 15px;    overflow: hidden;    transition: all 0.3s;    border: 1px solid rgba(255, 255, 255, 0.1);  }  .similar-car-card:hover {    transform: translateY(-10px);    border-color: var(--gold);  }  .similar-car-img {    width: 100%;    height: 180px;    object-fit: cover;  }  @media (max-width: 768px) {    .main-image { height: 250px; }    .car-title { font-size: 1.4rem; }    .car-price { font-size: 1.5rem; }    .specs-grid { grid-template-columns: repeat(2, 1fr); }  }</style>{% endblock %}{% block content %}<div class="container py-4">  <nav aria-label="breadcrumb" class="mb-4">    <ol class="breadcrumb">      <li class="breadcrumb-item"><a href="{% url 'home' %}" class="text-warning">صفحه اصلی</a></li>      <li class="breadcrumb-item"><a href="{% url 'car_list' %}" class="text-warning">خودروها</a></li>      <li class="breadcrumb-item active text-white" aria-current="page">{{ car.title }}</li>    </ol>  </nav>  <div class="row g-4">    <div class="col-lg-7">      <div class="car-gallery" data-aos="fade-up">        {% with main_image=car.get_main_image %}        {% if main_image %}        <img src="{{ main_image.url }}" alt="{{ car.title }}" class="main-image" id="mainImage">        {% else %}        <div class="main-image d-flex align-items-center justify-content-center bg-secondary">          <i class="fas fa-car fa-4x text-muted"></i>        </div>        {% endif %}        {% endwith %}      </div>      {% if car.images.count > 1 %}      <div class="thumbnail-list">        {% for image in car.images.all %}        <img src="{{ image.image.url }}" alt="{{ car.title }}"              class="thumbnail {% if forloop.first %}active{% endif %}"              onclick="changeImage(this, '{{ image.image.url }}')">        {% endfor %}      </div>      {% endif %}    </div>    <div class="col-lg-5">      <div data-aos="fade-up" data-aos-delay="100">        <h1 class="car-title">{{ car.title }}</h1>        <p class="text-muted mb-3">          <i class="fas fa-map-marker-alt me-2"></i>{{ car.city }}          <span class="mx-2">|</span>          <i class="fas fa-eye me-2"></i>{{ car.view_count }} بازدید        </p>        <div class="mb-4">          {% if car.original_price and car.discount_percentage > 0 %}          <span class="car-price-original">{{ car.original_price }} تومان</span>          {% endif %}          <div class="car-price">{{ car.price }} تومان</div>          {% if car.discount_percentage > 0 %}          <span class="badge bg-danger ms-2">{{ car.discount_percentage }}% تخفیف</span>          {% endif %}        </div>        <div class="mb-4">          {% if car.status == 'available' %}          <span class="badge bg-success fs-6 px-3 py-2"><i class="fas fa-check-circle me-2"></i>موجود</span>          {% elif car.status == 'reserved' %}          <span class="badge bg-warning fs-6 px-3 py-2"><i class="fas fa-clock me-2"></i>رزرو شده</span>          {% else %}          <span class="badge bg-secondary fs-6 px-3 py-2"><i class="fas fa-times-circle me-2"></i>فروخته شده</span>          {% endif %}        </div>        {% if car.status == 'available' %}        <button class="btn btn-primary btn-action add-to-cart-btn" data-url="{% url 'cart_add' car.id %}">          <i class="fas fa-cart-plus me-2"></i>افزودن به سبد خرید        </button>        {% endif %}        {% if user.is_authenticated %}        <button class="btn btn-favorite btn-action {% if is_favorited %}active{% endif %}"                 onclick="toggleFavorite({{ car.id }})" id="favoriteBtn">          <i class="{% if is_favorited %}fas{% else %}far{% endif %} fa-heart me-2"></i>          <span id="favoriteText">{% if is_favorited %}حذف از علاقه‌مندی‌ها{% else %}افزودن به علاقه‌مندی‌ها{% endif %}</span>        </button>        {% endif %}        <div class="dealer-card mt-4">          <div class="d-flex align-items-center gap-3">            {% if car.seller.avatar %}            <img src="{{ car.seller.avatar.url }}" alt="{{ car.seller.get_full_name }}" class="dealer-avatar">            {% else %}            <div class="dealer-avatar d-flex align-items-center justify-content-center bg-secondary">              <i class="fas fa-user fa-2x"></i>            </div>            {% endif %}            <div>              <h5 class="mb-1">{{ car.seller.get_full_name|default:car.seller.username }}</h5>              <p class="text-muted mb-0"><i class="fas fa-phone me-2"></i>{{ car.seller.phone }}</p>            </div>          </div>          <a href="{% url 'dealer_detail' car.seller.id %}" class="btn btn-outline-light w-100 mt-3">            مشاهده پروفایل فروشنده          </a>        </div>      </div>    </div>  </div>  <div class="mt-5" data-aos="fade-up">    <h3 class="mb-4"><i class="fas fa-cogs me-2 text-warning"></i>مشخصات فنی</h3>    <div class="specs-grid">      <div class="spec-item">        <div class="spec-icon"><i class="fas fa-calendar"></i></div>        <div class="spec-label">سال ساخت</div>        <div class="spec-value">{{ car.year }}</div>      </div>      <div class="spec-item">        <div class="spec-icon"><i class="fas fa-tachometer-alt"></i></div>        <div class="spec-label">کارکرد</div>        <div class="spec-value">{{ car.mileage }} km</div>      </div>      <div class="spec-item">        <div class="spec-icon"><i class="fas fa-palette"></i></div>        <div class="spec-label">رنگ</div>        <div class="spec-value">{{ car.color }}</div>      </div>      <div class="spec-item">        <div class="spec-icon"><i class="fas fa-cog"></i></div>        <div class="spec-label">گیربکس</div>        <div class="spec-value">{{ car.get_transmission_display }}</div>      </div>      <div class="spec-item">        <div class="spec-icon"><i class="fas fa-gas-pump"></i></div>        <div class="spec-label">سوخت</div>        <div class="spec-value">{{ car.get_fuel_type_display }}</div>      </div>      <div class="spec-item">        <div class="spec-icon"><i class="fas fa-car-side"></i></div>        <div class="spec-label">بدنه</div>        <div class="spec-value">{{ car.get_body_type_display }}</div>      </div>      {% if car.engine_capacity %}      <div class="spec-item">        <div class="spec-icon"><i class="fas fa-engine"></i></div>        <div class="spec-label">حجم موتور</div>        <div class="spec-value">{{ car.engine_capacity }} L</div>      </div>      {% endif %}      {% if car.horsepower %}      <div class="spec-item">        <div class="spec-icon"><i class="fas fa-horse"></i></div>        <div class="spec-label">قدرت</div>        <div class="spec-value">{{ car.horsepower }} hp</div>      </div>      {% endif %}    </div>  </div>  <div class="mt-5" data-aos="fade-up">    <h3 class="mb-4"><i class="fas fa-star me-2 text-warning"></i>امکانات</h3>    <div>      {% if car.has_airbags %}<span class="feature-badge"><i class="fas fa-shield-alt"></i>کیسه هوا</span>{% endif %}      {% if car.has_abs %}<span class="feature-badge"><i class="fas fa-circle-notch"></i>ترمز ABS</span>{% endif %}      {% if car.has_esc %}<span class="feature-badge"><i class="fas fa-car-crash"></i>کنترل پایداری</span>{% endif %}      {% if car.has_cruise %}<span class="feature-badge"><i class="fas fa-tachometer-alt"></i>کروز کنترل</span>{% endif %}      {% if car.has_sunroof %}<span class="feature-badge"><i class="fas fa-sun"></i>سانروف</span>{% endif %}      {% if car.has_navigation %}<span class="feature-badge"><i class="fas fa-map-marked-alt"></i>مسیریاب</span>{% endif %}      {% if car.has_leather %}<span class="feature-badge"><i class="fas fa-chair"></i>صندلی چرم</span>{% endif %}      {% if car.has_heated_seats %}<span class="feature-badge"><i class="fas fa-fire"></i>گرمکن صندلی</span>{% endif %}    </div>  </div>  <div class="mt-5" data-aos="fade-up">    <h3 class="mb-4"><i class="fas fa-align-right me-2 text-warning"></i>توضیحات</h3>    <div class="glass-card">      {{ car.description|safe }}    </div>  </div>  {% if related_cars %}  <div class="mt-5" data-aos="fade-up">    <h3 class="mb-4"><i class="fas fa-th-large me-2 text-warning"></i>خودروهای مشابه</h3>    <div class="row g-4">      {% for related in related_cars %}      <div class="col-md-6 col-lg-3">        <div class="similar-car-card">          {% with img=related.get_main_image %}          {% if img %}          <img src="{{ img.url }}" alt="{{ related.title }}" class="similar-car-img">          {% else %}          <div class="similar-car-img d-flex align-items-center justify-content-center bg-secondary">            <i class="fas fa-car fa-2x text-muted"></i>          </div>          {% endif %}          {% endwith %}          <div class="p-3">            <h6 class="mb-2">{{ related.title|truncatechars:30 }}</h6>            <p class="text-warning fw-bold mb-2">{{ related.price }} تومان</p>            <a href="{{ related.get_absolute_url }}" class="btn btn-outline-light btn-sm w-100">مشاهده</a>          </div>        </div>      </div>      {% endfor %}    </div>  </div>  {% endif %}</div>{% endblock %}{% block extra_js %}<script>  function changeImage(thumb, src) {    document.getElementById('mainImage').src = src;    document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));    thumb.classList.add('active');  }  function toggleFavorite(carId) {    fetch(`/favorites/toggle/${carId}/`, {      method: 'POST',      headers: {        'X-CSRFToken': '{{ csrf_token }}',        'Content-Type': 'application/json'      }    })    .then(response => response.json())    .then(data => {      const btn = document.getElementById('favoriteBtn');      const text = document.getElementById('favoriteText');      const icon = btn.querySelector('i');            if (data.status === 'added') {        btn.classList.add('active');        icon.classList.remove('far');        icon.classList.add('fas');        text.textContent = 'حذف از علاقه‌مندی‌ها';      } else {        btn.classList.remove('active');        icon.classList.remove('fas');        icon.classList.add('far');        text.textContent = 'افزودن به علاقه‌مندی‌ها';      }    });  }</script>{% endblock %}